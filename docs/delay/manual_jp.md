# Delay - ステレオ・ディレイ・モジュール

**注意：このマニュアルはAI生成によって作られており、順次更新していく予定です。**

Repitch、Fade、Reverse、Ping-pongの4つのディレイ・モードを備えたプロフェッショナルなステレオ・ディレイ・エンジンです。高品質なオーディオ処理を実現するHermite補間を採用し、Ableton Liveにインスパイアされたデザインです。

## 概要

Delayは、4つの異なるディレイ・モードと高品質なオーディオ処理を提供するプロフェッショナル・グレードのステレオ・ディレイ・エフェクト・モジュールです。調整可能なディレイ・タイム（0.001秒〜5.000秒）、フィードバック、トーン・フィルター、モジュレーション・デプス、ドライ/ウェット・ミキシングを備えています。

## クイック・スタート

1. オーディオ・ソースをAUDIO L/R INPUTに接続
2. 出力をAUDIO L/R OUTPUTに接続
3. MODEボタンでディレイ・モードを選択（4つのモードが利用可能）
4. TIMEノブでディレイ・タイムを調整（0.001秒〜5.000秒）
5. FEEDBACKノブで繰り返しを制御
6. WETノブで原音とディレイ音のバランスを調整

## パラメータ

### メイン・コントロール

**TIME** (0.0〜1.0、デフォルト 0.5)
- ディレイ・タイムの制御（秒単位で表示：0.001秒〜5.000秒）
- 音楽的なレスポンスのための指数カーブ
  - 12時位置（50%）= 2.5秒
  - 範囲：1ミリ秒〜5秒
- CV入力対応

**FEEDBACK** (0.0〜0.95、デフォルト 0.5)
- ディレイの繰り返し量
- 高い値ほど多くのエコーを作成
- CV入力対応
- 最大95%で無限フィードバック・ループを防止

**WET** (0.0〜1.0、デフォルト 0.5)
- ドライ/ウェット・ミックス比
- 0.0: 100% ドライ（原音のみ）
- 1.0: 100% ウェット（ディレイ音のみ）
- **等パワー・クロスフェード**使用（cos/sinによる音量一定）
  - 全てのミックス位置で均一なRMSレベル
  - 音量変化のないスムーズな遷移
- CV入力対応

**TONE** (0.0〜1.0、デフォルト 0.5)
- ディレイのフィードバック・パス用トーン・フィルター
- 低い値（0.0〜0.4）：ローパス・フィルター（温かいサウンド、暗いトーン）
- 高い値（0.6〜1.0）：ハイパス・フィルター（明るいサウンド、明るいトーン）
- 周波数範囲：20Hz〜20kHz（対数カーブ）
- CV入力対応

**MOD** (0.0〜1.0、デフォルト 0.0)
- モジュレーション・デプス（WOWエフェクト）
- ディレイに微細なピッチ・モジュレーションを追加
- CV入力対応
- テープのようなワウ＆フラッター・エフェクトを作成

### モード選択

**MODE BUTTON**
- 4つのディレイ・モードをサイクル：
  1. **Repitch**: ディレイ・タイム変更時にピッチが変わる（ハードウェアライク）
  2. **Fade**: 新旧ディレイ・タイム間のクロスフェード（Ableton Liveスタイル）
  3. **Reverse**: ディレイ・バッファの逆再生
  4. **Ping-pong**: ディレイが左右のチャンネル間で跳ね返る

モード・ライトが現在のモードを表示：
- **Repitch Light**: Repitchモード有効
- **Fade Light**: Fadeモード有効
- **Reverse Light**: Reverseモード有効
- **Ping-pong Light**: Ping-pongモード有効

## 信号処理詳細

### 入力と出力範囲
**入力信号:**
- 正常範囲: -5.0V 〜 +5.0V（VCV Rack標準）
- クリッピング防止: 内部処理により自動的に保護
- サンプリング・レート: 44.1kHz, 48kHz, 96kHz に対応

**出力信号:**
- 正常範囲: -5.0V 〜 +5.0V（ソフトクリッピング防止）
- ドライ/ウェット・ミックス後の出力範囲をクランプ
- 有効値検出: NaNやinfを検出した場合0.0Vに設定

### フィードバック制御
**フィードバック量:**
- ユーザー入力: 0.0% 〜 95%
- モード別スケーリング: 各モードでフィードバック量を調整
  - Reverseモード: より少なめ（逆再生時にブーストアップを防止）
  - Ping-pongモード: 標準（左右交互再生）
  - Repitch/Fadeモード: 標準

**フィードバック保護:**
- 最大95%制限で無限ループ防止
- モードスケール乗算による安全マージン

**フィードバック・トーン制御:**
- フィードバック・パスにトーン・フィルター適用
- パラメータ別の周波数範囲をクランプ

### ドライ/ウェット・ミックス
**等パワー・クロスフェード:**
```
dryGain = cos(kTwoPi * 0.25 * wetLevel)
wetGain = sin(kTwoPi * 0.25 * wetLevel)
output = drySignal * dryGain + wetSignal * wetGain
```
- 利点: どのミックス位置でもRMSレベルが一定
- ソフトクリップ防止: 入力レベルが変化しても出力レベルは一定
- スムーズなフェード: クリックやポップ音なし

**ミックス範囲:**
- 完全ドライ: 原音のみ
- 完全ウェット: ディレイ音のみ
- ドライ/ウェット: 最も一般的な使用法
- 最大レベル: ドライとウェットが同時に最大レベルで -5dB（等パワー）

### アンチエイリアシング・フィルター
**低パス・フィルター（補間アーティファクト除去）:**
- モジュレーション防止のための1極ローパス・フィルター
- カットオフ周波数: 可変（信号レベルに応じて変化）
- 目的: 急激なディレイタイム変更時の高周波ノイズ抑制

**適用箇所:**
- Fadeモード: クロスフェード遷移時のノイズ抑制
- Repitchモード: ピッチシフト時のアーティファクト抑制
- Reverseモード: 逆再生時のスムージング

**適用箇所:**
- Fadeモード: クロスフェード遷移時のノイズ抑制
- Repitchモード: ピッチシフト時のアーティファクト抑制
- Reverseモード: 逆再生時のスムージング

### クリッピング防止
**ソフト・クリッピング:**
- 入力レベルを監視し、クリップを検出
- クリップした信号をソフトな非線形カーブで飽和
- 利点: 可聴的な歪みを最小限に抑える

**範囲保護:**
- ドライ/ウェット・ミックス出力: -5.0V 〜 +5.0V
- フィードバック信号: -5.0V 〜 +5.0V
- 内部処理: 全ての中間値で範囲保護

### トーン・フィルター
**2バンド・ステート・バリアブル・フィルター:**
- バンド1: 20Hz 〜 300Hz（低域）
- バンド2: 300Hz 〜 3kHz（中域）
- 周波数は対数スケールで制御（INTENSITYパラメータ）
- INTENSITY = 0: 20Hz（最低）
- INTENSITY = 1.0: 20kHz（最高）

**トーン・カーブ:**
- 0.0〜0.4: ローパス（低域を強調）
- 0.5: フラット（トーン補正なし）
- 0.6〜1.0: ハイパス（高域を強調）

### モジュレーション（MODパラメータ）
**LFO（低周波発振器）モジュレーション:**
- モジュレーション深度: 0.0% 〜 100%
- LFOレート: 可変（現在は内部に固定）
- モジュレーション対象: ディレイ・タイム
- エフェクト: テープのワウ＆フラッター
- 深度が深いほど: より顕著なピッチ変動

## トランジション・モード（右クリック・コンテキスト・メニュー）

モジュールを右クリックしてトランジション・モード・オプションにアクセスします。これらはTIMEノブやCVでディレイ・タイムが変更されたときの挙動を制御します。

### Repitchトランジション
- ディレイ・タイムの変更がピッチ・シフトを引き起こす
- ハードウェア・ライクな挙動（テープ停止）
- ドラマチックなテープ・ストップ・エフェクトを作成
- ヴィンテージ・テープ・ディレイに似ている
- 速度: 滑らかなピッチ・グライド（rate=0.001）

### Fadeトランジション（デフォルト）
- 新旧ディレイ・タイム間のスムーズなクロスフェード
- マルチ・ボイス方式を使用：
  - 最大4つのボイスを管理
  - 各ボイスは固定のディレイタイムで読み取り
  - ボイス間のクロスフェードで遷移
- ピッチの変化なし - 各ボイスは固定位置で読む
- 即座のレスポンス - 新しいボイスは即座に新しい位置から読む
- 600msのクロスフェード時間でアーティファクトのない遷移
- クリーンでプロフェッショナルなサウンド
- Ableton Live Fade Delayにインスパイア
- ボイス切り替え比率: 10%（指数スケール対応）

### Jumpトランジション
- 新しいディレイ・タイムに即座にジャンプ
- グリッチー/アーティファクト・エフェクトを作成できる
- 実験的なサウンドに役立つ
- 遷移時にクリック音が発生する可能性がある

## 信号処理フロー

1. 入力信号（L/R）がディレイ・バッファに入力
2. ディレイ・タイムがバッファからの読み取り位置を制御
3. トランジション・モードが時間の変更がどのように処理されるかを決定
4. トーン・フィルターがフィードバック・パスに適用
5. モジュレーションが微細なピッチ変調を追加（MOD > 0の場合）
6. フィードバックがディレイ信号を入力に戻す
7. ドライ/ウェット・クロスフェードで出力ミキシング
8. アンチエイリアシング・フィルターが最終出力を滑らかにする
9. ディレイ・コンテンツを含む出力信号（L/R）

## CV入力

すべてのCV入力は±10V信号を受け付けます：
- **TIME CV**: ディレイ・タイムをモジュレート
- **TONE CV**: トーン・フィルター周波数をモジュレート
- **FEEDBACK CV**: フィードバック量をモジュレート
- **WET CV**: ドライ/ウェット・ミックスをモジュレート

CV入力はノブ・ポジションに加算されます。

## 技術仕様

- サンプリング・レート対応: 44.1kHz, 48kHz, 96kHz
- 補間方式: Hermite補間（Catmull-Romスプライン）
- 最大ディレイ長: 5秒
- 最小ディレイ長: 1ms
- チャンネル数: 2（ステレオ）
- CV入力: 4つ（TIME, FEEDBACK, WET, TONE）
- CPU使用率: 最小化（効率的なDSP実装）

## トラブルシューティング

### 出力が小さすぎる場合
- WETノブを上げる（0.5〜1.0）
- FEEDBACKを上げる
- 入力レベルを確認

### 出力が歪む場合
- WETノブを下げる
- FEEDBACKを下げる
- 入力レベルを下げる

### フィードバックが鳴り続く場合
- FEEDBACKを下げる（95%以下にする）
- 入力信号を確認
- Reverseモードの場合、より低いフィードバック値を使用

### ディレイ時間が変わらない場合
- CV入力が接続されているか確認
- TIMEノブが正しく動作しているか確認
- トランジション・モードが意図通りか確認
